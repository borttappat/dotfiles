#!/run/current-system/sw/bin/bash

STATE_FILE="/tmp/pomodoro_state"

# Function to initialize or toggle the timer
toggle_timer() {
  if [ ! -f "$STATE_FILE" ]; then
    echo "WORK $(date +%s)" > "$STATE_FILE"
    i3-msg 'exec --no-startup-id alacritty --class pomo -e sh -c "echo Work session started! && read"'
    sleep 0.5
    i3-msg '[class="^pomo$"] floating enable; resize set width 300px height 100px; move position center'
  else
    read state start_time < "$STATE_FILE"
    if [ "$state" == "WORK" ]; then
      echo "REST $(date +%s)" > "$STATE_FILE"
      i3-msg 'exec --no-startup-id alacritty --class pomo -e sh -c "echo Time to rest! && read"'
      sleep 0.5
      i3-msg '[class="^pomo$"] floating enable; resize set width 300px height 100px; move position center'
    else
      echo "WORK $(date +%s)" > "$STATE_FILE"
      i3-msg 'exec --no-startup-id alacritty --class pomo -e sh -c "echo Time to work! && read"'
      sleep 0.5
      i3-msg '[class="^pomo$"] floating enable; resize set width 300px height 100px; move position center'
    fi
  fi
}

# Function to stop the timer
stop_timer() {
  if [ -f "$STATE_FILE" ]; then
    rm "$STATE_FILE"
    echo "Pomodoro timer stopped."
  else
    echo "Pomodoro timer is not running."
  fi
}

case "$1" in
  toggle)
    toggle_timer
    ;;
  stop)
    stop_timer
    ;;
  *)
    echo "Usage: pomo {toggle|stop}"
    exit 1
    ;;
esac

